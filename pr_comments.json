{"comments":[{"id":"IC_kwDOQfAErM7eEEcG","author":{"login":"github-actions"},"authorAssociation":"NONE","body":"### Test Results (Node 24.x)\n\n‚ùå Failed\n\n<details><summary>Show Output</summary>\n\n```\n\n> drachenboot-app@3.7.0 test\n> NODE_ENV=test jest --maxWorkers=10\n\nPASS src/app/api/webhooks/stripe/__tests__/handlers.test.ts\nPASS src/utils/__tests__/importUtils.test.ts\nPASS src/lib/__tests__/mcp-auth.test.ts\nPASS src/lib/__tests__/api-auth.test.ts\nPASS src/lib/mcp/__tests__/postgres-session-store.test.ts\n  ‚óè Console\n\n    console.error\n      [PostgresSessionStore] Operation failed after 1 attempts: Record to delete does not exist.\n\n    ^[[0m ^[[90m 129 |^[[39m\n     ^[[90m 130 |^[[39m                 ^[[36mif^[[39m (^[[33m!^[[39misTransient ^[[33m||^[[39m attempt ^[[33m===^[[39m ^[[36mthis^[[39m^[[33m.^[[39mmaxRetries) {\n    ^[[31m^[[1m>^[[22m^[[39m^[[90m 131 |^[[39m                     console^[[33m.^[[39merror(^[[32m`[PostgresSessionStore] Operation failed after ${attempt + 1} attempts:`^[[39m^[[33m,^[[39m lastError^[[33m.^[[39mmessage)^[[33m;^[[39m\n     ^[[90m     |^[[39m                             ^[[31m^[[1m^^[[22m^[[39m\n     ^[[90m 132 |^[[39m                     ^[[36mthrow^[[39m lastError^[[33m;^[[39m\n     ^[[90m 133 |^[[39m                 }\n     ^[[90m 134 |^[[39m^[[0m\n\n      at PostgresSessionStore.error [as withRetry] (src/lib/mcp/postgres-session-store.ts:131:29)\n      at PostgresSessionStore.removeSession (src/lib/mcp/postgres-session-store.ts:105:13)\n      at Object.<anonymous> (src/lib/mcp/__tests__/postgres-session-store.test.ts:113:9)\n\nPASS src/services/stripe/__tests__/stripe-service.test.ts\nPASS src/utils/__tests__/url-validation.test.ts\nFAIL src/components/drachenboot/__tests__/TeamSwitcher.test.tsx\n  ‚óè Test suite failed to run\n\n    Jest encountered an unexpected token\n\n    Jest failed to parse a file. This happens e.g. when your code or its dependencies use non-standard JavaScript syntax, or when Jest is not configured to support such syntax.\n\n    Out of the box Jest supports Babel, which will be used to transform your files into valid JS based on your Babel configuration.\n\n    By default \"node_modules\" folder is ignored by transformers.\n\n    Here's what you can do:\n     ‚Ä¢ If you are trying to use ECMAScript Modules, see https://jestjs.io/docs/ecmascript-modules for how to enable it.\n     ‚Ä¢ If you are trying to use TypeScript, see https://jestjs.io/docs/getting-started#using-typescript\n     ‚Ä¢ To have some of your \"node_modules\" files transformed, you can specify a custom \"transformIgnorePatterns\" in your config.\n     ‚Ä¢ If you need a custom transformation, specify a \"transform\" option in your config.\n     ‚Ä¢ If you simply want to mock your non-JS modules (e.g. binary assets) you can stub them out with the \"moduleNameMapper\" config option.\n\n    You'll find more details and examples of these config options in the docs:\n    https://jestjs.io/docs/configuration\n    For information about custom transformations, see:\n    https://jestjs.io/docs/code-transformation\n\n    Details:\n\n    /home/runner/work/drachenbootplan/drachenbootplan/node_modules/next-intl/dist/esm/production/index.react-client.js:1\n    export{useFormatter,useTranslations}from\"./react-client/index.js\";export{default as NextIntlClientProvider}from\"./shared/NextIntlClientProvider.js\";export{IntlProvider,_useExtracted as useExtracted,useLocale,useMessages,useNow,useTimeZone}from\"use-intl/react\";export*from\"use-intl/core\";\n    ^^^^^^\n\n    SyntaxError: Unexpected token 'export'\n\n    ^[[0m ^[[90m 21 |^[[39m   ^[[36mconst^[[39m pathname ^[[33m=^[[39m usePathname()^[[33m;^[[39m\n     ^[[90m 22 |^[[39m\n    ^[[31m^[[1m>^[[22m^[[39m^[[90m 23 |^[[39m   useEffect(() ^[[33m=>^[[39m {\n     ^[[90m    |^[[39m                   ^[[31m^[[1m^^[[22m^[[39m\n     ^[[90m 24 |^[[39m     ^[[36mif^[[39m (status ^[[33m!==^[[39m ^[[32m'loading'^[[39m) {\n     ^[[90m 25 |^[[39m       ^[[90m// Sync logic disabled to avoid navigation loops. ^[[39m\n     ^[[90m 26 |^[[39m       ^[[90m// Middleware handles initial redirect.^[[39m^[[0m\n\n      at Runtime.createScriptFromCode (node_modules/jest-runtime/build/index.js:1318:40)\n      at Object.<anonymous> (src/context/LanguageContext.tsx:23:19)\n      at Object.<anonymous> (src/components/drachenboot/TeamSwitcher.tsx:15:26)\n      at Object.<anonymous> (src/components/drachenboot/__tests__/TeamSwitcher.test.tsx:25:62)\n\nFAIL src/components/auth/__tests__/OnboardingModal.test.tsx\n  ‚óè Test suite failed to run\n\n    Jest encountered an unexpected token\n\n    Jest failed to parse a file. This happens e.g. when your code or its dependencies use non-standard JavaScript syntax, or when Jest is not configured to support such syntax.\n\n    Out of the box Jest supports Babel, which will be used to transform your files into valid JS based on your Babel configuration.\n\n    By default \"node_modules\" folder is ignored by transformers.\n\n    Here's what you can do:\n     ‚Ä¢ If you are trying to use ECMAScript Modules, see https://jestjs.io/docs/ecmascript-modules for how to enable it.\n     ‚Ä¢ If you are trying to use TypeScript, see https://jestjs.io/docs/getting-started#using-typescript\n     ‚Ä¢ To have some of your \"node_modules\" files transformed, you can specify a custom \"transformIgnorePatterns\" in your config.\n     ‚Ä¢ If you need a custom transformation, specify a \"transform\" option in your config.\n     ‚Ä¢ If you simply want to mock your non-JS modules (e.g. binary assets) you can stub them out with the \"moduleNameMapper\" config option.\n\n    You'll find more details and examples of these config options in the docs:\n    https://jestjs.io/docs/configuration\n    For information about custom transformations, see:\n    https://jestjs.io/docs/code-transformation\n\n    Details:\n\n    /home/runner/work/drachenbootplan/drachenbootplan/node_modules/next-intl/dist/esm/production/index.react-client.js:1\n    export{useFormatter,useTranslations}from\"./react-client/index.js\";export{default as NextIntlClientProvider}from\"./shared/NextIntlClientProvider.js\";export{IntlProvider,_useExtracted as useExtracted,useLocale,useMessages,useNow,useTimeZone}from\"use-intl/react\";export*from\"use-intl/core\";\n    ^^^^^^\n\n    SyntaxError: Unexpected token 'export'\n\n    ^[[0m ^[[90m 21 |^[[39m   ^[[36mconst^[[39m pathname ^[[33m=^[[39m usePathname()^[[33m;^[[39m\n     ^[[90m 22 |^[[39m\n    ^[[31m^[[1m>^[[22m^[[39m^[[90m 23 |^[[39m   useEffect(() ^[[33m=>^[[39m {\n     ^[[90m    |^[[39m                   ^[[31m^[[1m^^[[22m^[[39m\n     ^[[90m 24 |^[[39m     ^[[36mif^[[39m (status ^[[33m!==^[[39m ^[[32m'loading'^[[39m) {\n     ^[[90m 25 |^[[39m       ^[[90m// Sync logic disabled to avoid navigation loops. ^[[39m\n     ^[[90m 26 |^[[39m       ^[[90m// Middleware handles initial redirect.^[[39m^[[0m\n\n      at Runtime.createScriptFromCode (node_modules/jest-runtime/build/index.js:1318:40)\n      at Object.<anonymous> (src/context/LanguageContext.tsx:23:19)\n      at Object.<anonymous> (src/components/auth/OnboardingModal.tsx:13:26)\n      at Object.<anonymous> (src/components/auth/__tests__/OnboardingModal.test.tsx:8:26)\n\nPASS src/components/drachenboot/team/__tests__/PaddlerForm.test.tsx\nPASS src/services/ical/__tests__/ical-service.test.ts\n  ‚óè Console\n\n    console.error\n      iCal Sync Error: Safety Stop: Attempting to delete 6 of 6 events (100.0%). Manual confirmation required.\n\n    ^[[0m ^[[90m 262 |^[[39m   } ^[[36mcatch^[[39m (error^[[33m:^[[39m unknown) {\n     ^[[90m 263 |^[[39m     ^[[36mconst^[[39m message ^[[33m=^[[39m error ^[[36minstanceof^[[39m ^[[33mError^[[39m ^[[33m?^[[39m error^[[33m.^[[39mmessage ^[[33m:^[[39m ^[[33mString^[[39m(error)^[[33m;^[[39m\n    ^[[31m^[[1m>^[[22m^[[39m^[[90m 264 |^[[39m     console^[[33m.^[[39merror(^[[32m'iCal Sync Error:'^[[39m^[[33m,^[[39m message)^[[33m;^[[39m\n     ^[[90m     |^[[39m             ^[[31m^[[1m^^[[22m^[[39m\n     ^[[90m 265 |^[[39m     ^[[90m// Log error^[[39m\n     ^[[90m 266 |^[[39m     ^[[36mawait^[[39m prisma^[[33m.^[[39msyncLog^[[33m.^[[39mcreate({\n     ^[[90m 267 |^[[39m       data^[[33m:^[[39m {^[[0m\n\n      at error (src/services/ical/ical-service.ts:264:13)\n      at Object.<anonymous> (src/services/ical/__tests__/ical-service.test.ts:151:5)\n\n    console.error\n      iCal Sync Error: No iCal URL provided\n\n    ^[[0m ^[[90m 262 |^[[39m   } ^[[36mcatch^[[39m (error^[[33m:^[[39m unknown) {\n     ^[[90m 263 |^[[39m     ^[[36mconst^[[39m message ^[[33m=^[[39m error ^[[36minstanceof^[[39m ^[[33mError^[[39m ^[[33m?^[[39m error^[[33m.^[[39mmessage ^[[33m:^[[39m ^[[33mString^[[39m(error)^[[33m;^[[39m\n    ^[[31m^[[1m>^[[22m^[[39m^[[90m 264 |^[[39m     console^[[33m.^[[39merror(^[[32m'iCal Sync Error:'^[[39m^[[33m,^[[39m message)^[[33m;^[[39m\n     ^[[90m     |^[[39m             ^[[31m^[[1m^^[[22m^[[39m\n     ^[[90m 265 |^[[39m     ^[[90m// Log error^[[39m\n     ^[[90m 266 |^[[39m     ^[[36mawait^[[39m prisma^[[33m.^[[39msyncLog^[[33m.^[[39mcreate({\n     ^[[90m 267 |^[[39m       data^[[33m:^[[39m {^[[0m\n\n      at error (src/services/ical/ical-service.ts:264:13)\n      at Object.<anonymous> (src/services/ical/__tests__/ical-service.test.ts:160:5)\n\n    console.error\n      iCal Sync Error: Invalid iCal URL (Security Check Failed)\n\n    ^[[0m ^[[90m 262 |^[[39m   } ^[[36mcatch^[[39m (error^[[33m:^[[39m unknown) {\n     ^[[90m 263 |^[[39m     ^[[36mconst^[[39m message ^[[33m=^[[39m error ^[[36minstanceof^[[39m ^[[33mError^[[39m ^[[33m?^[[39m error^[[33m.^[[39mmessage ^[[33m:^[[39m ^[[33mString^[[39m(error)^[[33m;^[[39m\n    ^[[31m^[[1m>^[[22m^[[39m^[[90m 264 |^[[39m     console^[[33m.^[[39merror(^[[32m'iCal Sync Error:'^[[39m^[[33m,^[[39m message)^[[33m;^[[39m\n     ^[[90m     |^[[39m             ^[[31m^[[1m^^[[22m^[[39m\n     ^[[90m 265 |^[[39m     ^[[90m// Log error^[[39m\n     ^[[90m 266 |^[[39m     ^[[36mawait^[[39m prisma^[[33m.^[[39msyncLog^[[33m.^[[39mcreate({\n     ^[[90m 267 |^[[39m       data^[[33m:^[[39m {^[[0m\n\n      at error (src/services/ical/ical-service.ts:264:13)\n      at Object.<anonymous> (src/services/ical/__tests__/ical-service.test.ts:170:5)\n\n    console.error\n      iCal Sync Error: Failed to fetch iCal: 404 Not Found\n\n    ^[[0m ^[[90m 262 |^[[39m   } ^[[36mcatch^[[39m (error^[[33m:^[[39m unknown) {\n     ^[[90m 263 |^[[39m     ^[[36mconst^[[39m message ^[[33m=^[[39m error ^[[36minstanceof^[[39m ^[[33mError^[[39m ^[[33m?^[[39m error^[[33m.^[[39mmessage ^[[33m:^[[39m ^[[33mString^[[39m(error)^[[33m;^[[39m\n    ^[[31m^[[1m>^[[22m^[[39m^[[90m 264 |^[[39m     console^[[33m.^[[39merror(^[[32m'iCal Sync Error:'^[[39m^[[33m,^[[39m message)^[[33m;^[[39m\n     ^[[90m     |^[[39m             ^[[31m^[[1m^^[[22m^[[39m\n     ^[[90m 265 |^[[39m     ^[[90m// Log error^[[39m\n     ^[[90m 266 |^[[39m     ^[[36mawait^[[39m prisma^[[33m.^[[39msyncLog^[[33m.^[[39mcreate({\n     ^[[90m 267 |^[[39m       data^[[33m:^[[39m {^[[0m\n\n      at error (src/services/ical/ical-service.ts:264:13)\n      at Object.<anonymous> (src/services/ical/__tests__/ical-service.test.ts:185:7)\n\n    console.error\n      iCal Sync Error: iCal file too large (max 5MB)\n\n    ^[[0m ^[[90m 262 |^[[39m   } ^[[36mcatch^[[39m (error^[[33m:^[[39m unknown) {\n     ^[[90m 263 |^[[39m     ^[[36mconst^[[39m message ^[[33m=^[[39m error ^[[36minstanceof^[[39m ^[[33mError^[[39m ^[[33m?^[[39m error^[[33m.^[[39mmessage ^[[33m:^[[39m ^[[33mString^[[39m(error)^[[33m;^[[39m\n    ^[[31m^[[1m>^[[22m^[[39m^[[90m 264 |^[[39m     console^[[33m.^[[39merror(^[[32m'iCal Sync Error:'^[[39m^[[33m,^[[39m message)^[[33m;^[[39m\n     ^[[90m     |^[[39m             ^[[31m^[[1m^^[[22m^[[39m\n     ^[[90m 265 |^[[39m     ^[[90m// Log error^[[39m\n     ^[[90m 266 |^[[39m     ^[[36mawait^[[39m prisma^[[33m.^[[39msyncLog^[[33m.^[[39mcreate({\n     ^[[90m 267 |^[[39m       data^[[33m:^[[39m {^[[0m\n\n      at error (src/services/ical/ical-service.ts:264:13)\n      at Object.<anonymous> (src/services/ical/__tests__/ical-service.test.ts:201:5)\n\nPASS src/utils/__tests__/safe-fetch.test.ts\nPASS src/utils/__tests__/event-utils.test.ts\n  ‚óè Console\n\n    console.warn\n      [filterFutureEvents] Invalid input: null\n\n    ^[[0m ^[[90m  9 |^[[39m   ^[[90m// 1. Fail Safe: Trust no input^[[39m\n     ^[[90m 10 |^[[39m   ^[[36mif^[[39m (^[[33m!^[[39m^[[33mArray^[[39m^[[33m.^[[39misArray(events)) {\n    ^[[31m^[[1m>^[[22m^[[39m^[[90m 11 |^[[39m     console^[[33m.^[[39mwarn(^[[32m'[filterFutureEvents] Invalid input:'^[[39m^[[33m,^[[39m events)^[[33m;^[[39m\n     ^[[90m    |^[[39m             ^[[31m^[[1m^^[[22m^[[39m\n     ^[[90m 12 |^[[39m     ^[[36mreturn^[[39m []^[[33m;^[[39m\n     ^[[90m 13 |^[[39m   }\n     ^[[90m 14 |^[[39m^[[0m\n\n      at warn (src/utils/event-utils.ts:11:13)\n      at Object.<anonymous> (src/utils/__tests__/event-utils.test.ts:68:32)\n\n    console.warn\n      [filterFutureEvents] Invalid input: undefined\n\n    ^[[0m ^[[90m  9 |^[[39m   ^[[90m// 1. Fail Safe: Trust no input^[[39m\n     ^[[90m 10 |^[[39m   ^[[36mif^[[39m (^[[33m!^[[39m^[[33mArray^[[39m^[[33m.^[[39misArray(events)) {\n    ^[[31m^[[1m>^[[22m^[[39m^[[90m 11 |^[[39m     console^[[33m.^[[39mwarn(^[[32m'[filterFutureEvents] Invalid input:'^[[39m^[[33m,^[[39m events)^[[33m;^[[39m\n     ^[[90m    |^[[39m             ^[[31m^[[1m^^[[22m^[[39m\n     ^[[90m 12 |^[[39m     ^[[36mreturn^[[39m []^[[33m;^[[39m\n     ^[[90m 13 |^[[39m   }\n     ^[[90m 14 |^[[39m^[[0m\n\n      at warn (src/utils/event-utils.ts:11:13)\n      at Object.<anonymous> (src/utils/__tests__/event-utils.test.ts:70:32)\n\n    console.warn\n      [filterFutureEvents] Invalid date encountered: invalid-date\n\n    ^[[0m ^[[90m 24 |^[[39m     ^[[90m// 3. Invalid Date Check^[[39m\n     ^[[90m 25 |^[[39m     ^[[36mif^[[39m (isNaN(eventDate^[[33m.^[[39mgetTime())) {\n    ^[[31m^[[1m>^[[22m^[[39m^[[90m 26 |^[[39m         console^[[33m.^[[39mwarn(^[[32m'[filterFutureEvents] Invalid date encountered:'^[[39m^[[33m,^[[39m event^[[33m.^[[39mdate)^[[33m;^[[39m\n     ^[[90m    |^[[39m                 ^[[31m^[[1m^^[[22m^[[39m\n     ^[[90m 27 |^[[39m         ^[[36mreturn^[[39m ^[[36mfalse^[[39m^[[33m;^[[39m\n     ^[[90m 28 |^[[39m     }\n     ^[[90m 29 |^[[39m^[[0m\n\n      at warn (src/utils/event-utils.ts:26:17)\n          at Array.filter (<anonymous>)\n      at filter (src/utils/event-utils.ts:19:17)\n      at Object.<anonymous> (src/utils/__tests__/event-utils.test.ts:75:40)\n\nFAIL src/components/ui/__tests__/Footer.test.tsx\n  ‚óè Test suite failed to run\n\n    Jest encountered an unexpected token\n\n    Jest failed to parse a file. This happens e.g. when your code or its dependencies use non-standard JavaScript syntax, or when Jest is not configured to support such syntax.\n\n    Out of the box Jest supports Babel, which will be used to transform your files into valid JS based on your Babel configuration.\n\n    By default \"node_modules\" folder is ignored by transformers.\n\n    Here's what you can do:\n     ‚Ä¢ If you are trying to use ECMAScript Modules, see https://jestjs.io/docs/ecmascript-modules for how to enable it.\n     ‚Ä¢ If you are trying to use TypeScript, see https://jestjs.io/docs/getting-started#using-typescript\n     ‚Ä¢ To have some of your \"node_modules\" files transformed, you can specify a custom \"transformIgnorePatterns\" in your config.\n     ‚Ä¢ If you need a custom transformation, specify a \"transform\" option in your config.\n     ‚Ä¢ If you simply want to mock your non-JS modules (e.g. binary assets) you can stub them out with the \"moduleNameMapper\" config option.\n\n    You'll find more details and examples of these config options in the docs:\n    https://jestjs.io/docs/configuration\n    For information about custom transformations, see:\n    https://jestjs.io/docs/code-transformation\n\n    Details:\n\n    /home/runner/work/drachenbootplan/drachenbootplan/node_modules/next-intl/dist/esm/production/routing.js:1\n    export{default as defineRouting}from\"./routing/defineRouting.js\";\n    ^^^^^^\n\n    SyntaxError: Unexpected token 'export'\n\n    ^[[0m^[[0m\n\n      at Runtime.createScriptFromCode (node_modules/jest-runtime/build/index.js:1318:40)\n      at Object.<anonymous> (src/i18n/routing.ts:28:18)\n      at Object.<anonymous> (src/components/ui/Footer.tsx:15:18)\n      at Object.<anonymous> (src/components/ui/__tests__/Footer.test.tsx:41:56)\n\nPASS src/components/drachenboot/team/__tests__/PaddlerModal.test.tsx\nPASS src/components/drachenboot/team/__tests__/PaddlerList.test.tsx\nPASS src/utils/__tests__/algorithm.test.ts\nPASS src/components/ui/__tests__/Header.test.tsx\nPASS src/components/drachenboot/__tests__/SeatBox.test.tsx\nPASS src/components/drachenboot/team/__tests__/ImportModal.test.tsx\nPASS src/components/drachenboot/__tests__/Stats.test.tsx\nPASS src/utils/algorithm.test.ts\n\nSummary of all failing tests\nFAIL src/components/drachenboot/__tests__/TeamSwitcher.test.tsx\n  ‚óè Test suite failed to run\n\n    Jest encountered an unexpected token\n\n    Jest failed to parse a file. This happens e.g. when your code or its dependencies use non-standard JavaScript syntax, or when Jest is not configured to support such syntax.\n\n    Out of the box Jest supports Babel, which will be used to transform your files into valid JS based on your Babel configuration.\n\n    By default \"node_modules\" folder is ignored by transformers.\n\n    Here's what you can do:\n     ‚Ä¢ If you are trying to use ECMAScript Modules, see https://jestjs.io/docs/ecmascript-modules for how to enable it.\n     ‚Ä¢ If you are trying to use TypeScript, see https://jestjs.io/docs/getting-started#using-typescript\n     ‚Ä¢ To have some of your \"node_modules\" files transformed, you can specify a custom \"transformIgnorePatterns\" in your config.\n     ‚Ä¢ If you need a custom transformation, specify a \"transform\" option in your config.\n     ‚Ä¢ If you simply want to mock your non-JS modules (e.g. binary assets) you can stub them out with the \"moduleNameMapper\" config option.\n\n    You'll find more details and examples of these config options in the docs:\n    https://jestjs.io/docs/configuration\n    For information about custom transformations, see:\n    https://jestjs.io/docs/code-transformation\n\n    Details:\n\n    /home/runner/work/drachenbootplan/drachenbootplan/node_modules/next-intl/dist/esm/production/index.react-client.js:1\n    export{useFormatter,useTranslations}from\"./react-client/index.js\";export{default as NextIntlClientProvider}from\"./shared/NextIntlClientProvider.js\";export{IntlProvider,_useExtracted as useExtracted,useLocale,useMessages,useNow,useTimeZone}from\"use-intl/react\";export*from\"use-intl/core\";\n    ^^^^^^\n\n    SyntaxError: Unexpected token 'export'\n\n    ^[[0m ^[[90m 21 |^[[39m   ^[[36mconst^[[39m pathname ^[[33m=^[[39m usePathname()^[[33m;^[[39m\n     ^[[90m 22 |^[[39m\n    ^[[31m^[[1m>^[[22m^[[39m^[[90m 23 |^[[39m   useEffect(() ^[[33m=>^[[39m {\n     ^[[90m    |^[[39m                   ^[[31m^[[1m^^[[22m^[[39m\n     ^[[90m 24 |^[[39m     ^[[36mif^[[39m (status ^[[33m!==^[[39m ^[[32m'loading'^[[39m) {\n     ^[[90m 25 |^[[39m       ^[[90m// Sync logic disabled to avoid navigation loops. ^[[39m\n     ^[[90m 26 |^[[39m       ^[[90m// Middleware handles initial redirect.^[[39m^[[0m\n\n      at Runtime.createScriptFromCode (node_modules/jest-runtime/build/index.js:1318:40)\n      at Object.<anonymous> (src/context/LanguageContext.tsx:23:19)\n      at Object.<anonymous> (src/components/drachenboot/TeamSwitcher.tsx:15:26)\n      at Object.<anonymous> (src/components/drachenboot/__tests__/TeamSwitcher.test.tsx:25:62)\n\nFAIL src/components/auth/__tests__/OnboardingModal.test.tsx\n  ‚óè Test suite failed to run\n\n    Jest encountered an unexpected token\n\n    Jest failed to parse a file. This happens e.g. when your code or its dependencies use non-standard JavaScript syntax, or when Jest is not configured to support such syntax.\n\n    Out of the box Jest supports Babel, which will be used to transform your files into valid JS based on your Babel configuration.\n\n    By default \"node_modules\" folder is ignored by transformers.\n\n    Here's what you can do:\n     ‚Ä¢ If you are trying to use ECMAScript Modules, see https://jestjs.io/docs/ecmascript-modules for how to enable it.\n     ‚Ä¢ If you are trying to use TypeScript, see https://jestjs.io/docs/getting-started#using-typescript\n     ‚Ä¢ To have some of your \"node_modules\" files transformed, you can specify a custom \"transformIgnorePatterns\" in your config.\n     ‚Ä¢ If you need a custom transformation, specify a \"transform\" option in your config.\n     ‚Ä¢ If you simply want to mock your non-JS modules (e.g. binary assets) you can stub them out with the \"moduleNameMapper\" config option.\n\n    You'll find more details and examples of these config options in the docs:\n    https://jestjs.io/docs/configuration\n    For information about custom transformations, see:\n    https://jestjs.io/docs/code-transformation\n\n    Details:\n\n    /home/runner/work/drachenbootplan/drachenbootplan/node_modules/next-intl/dist/esm/production/index.react-client.js:1\n    export{useFormatter,useTranslations}from\"./react-client/index.js\";export{default as NextIntlClientProvider}from\"./shared/NextIntlClientProvider.js\";export{IntlProvider,_useExtracted as useExtracted,useLocale,useMessages,useNow,useTimeZone}from\"use-intl/react\";export*from\"use-intl/core\";\n    ^^^^^^\n\n    SyntaxError: Unexpected token 'export'\n\n    ^[[0m ^[[90m 21 |^[[39m   ^[[36mconst^[[39m pathname ^[[33m=^[[39m usePathname()^[[33m;^[[39m\n     ^[[90m 22 |^[[39m\n    ^[[31m^[[1m>^[[22m^[[39m^[[90m 23 |^[[39m   useEffect(() ^[[33m=>^[[39m {\n     ^[[90m    |^[[39m                   ^[[31m^[[1m^^[[22m^[[39m\n     ^[[90m 24 |^[[39m     ^[[36mif^[[39m (status ^[[33m!==^[[39m ^[[32m'loading'^[[39m) {\n     ^[[90m 25 |^[[39m       ^[[90m// Sync logic disabled to avoid navigation loops. ^[[39m\n     ^[[90m 26 |^[[39m       ^[[90m// Middleware handles initial redirect.^[[39m^[[0m\n\n      at Runtime.createScriptFromCode (node_modules/jest-runtime/build/index.js:1318:40)\n      at Object.<anonymous> (src/context/LanguageContext.tsx:23:19)\n      at Object.<anonymous> (src/components/auth/OnboardingModal.tsx:13:26)\n      at Object.<anonymous> (src/components/auth/__tests__/OnboardingModal.test.tsx:8:26)\n\nFAIL src/components/ui/__tests__/Footer.test.tsx\n  ‚óè Test suite failed to run\n\n    Jest encountered an unexpected token\n\n    Jest failed to parse a file. This happens e.g. when your code or its dependencies use non-standard JavaScript syntax, or when Jest is not configured to support such syntax.\n\n    Out of the box Jest supports Babel, which will be used to transform your files into valid JS based on your Babel configuration.\n\n    By default \"node_modules\" folder is ignored by transformers.\n\n    Here's what you can do:\n     ‚Ä¢ If you are trying to use ECMAScript Modules, see https://jestjs.io/docs/ecmascript-modules for how to enable it.\n     ‚Ä¢ If you are trying to use TypeScript, see https://jestjs.io/docs/getting-started#using-typescript\n     ‚Ä¢ To have some of your \"node_modules\" files transformed, you can specify a custom \"transformIgnorePatterns\" in your config.\n     ‚Ä¢ If you need a custom transformation, specify a \"transform\" option in your config.\n     ‚Ä¢ If you simply want to mock your non-JS modules (e.g. binary assets) you can stub them out with the \"moduleNameMapper\" config option.\n\n    You'll find more details and examples of these config options in the docs:\n    https://jestjs.io/docs/configuration\n    For information about custom transformations, see:\n    https://jestjs.io/docs/code-transformation\n\n    Details:\n\n    /home/runner/work/drachenbootplan/drachenbootplan/node_modules/next-intl/dist/esm/production/routing.js:1\n    export{default as defineRouting}from\"./routing/defineRouting.js\";\n    ^^^^^^\n\n    SyntaxError: Unexpected token 'export'\n\n    ^[[0m^[[0m\n\n      at Runtime.createScriptFromCode (node_modules/jest-runtime/build/index.js:1318:40)\n      at Object.<anonymous> (src/i18n/routing.ts:28:18)\n      at Object.<anonymous> (src/components/ui/Footer.tsx:15:18)\n      at Object.<anonymous> (src/components/ui/__tests__/Footer.test.tsx:41:56)\n\n\nTest Suites: 3 failed, 19 passed, 22 total\nTests:       115 passed, 115 total\nSnapshots:   0 total\nTime:        5.658 s\nRan all test suites.\n\n```\n</details>","createdAt":"2026-01-08T20:19:24Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/janhartje/drachenbootplan/pull/129#issuecomment-3725608710","viewerDidAuthor":false},{"id":"IC_kwDOQfAErM7eEFBC","author":{"login":"janhartje"},"authorAssociation":"OWNER","body":"# üö® Risikoeinsch√§tzung: WARNUNG\n\nDas Review deckt mehrere Verst√∂√üe gegen Defensive Programming und Type Safety auf. Der Code ist funktional, aber fragil.\n\n# üõ°Ô∏è Sicherheits- & Stabilit√§ts-Check\n\n1.  **Explizite `any` Typen (Critical)**:\n    In `src/app/[locale]/layout.tsx` wird `any` f√ºr `getNestedValue` verwendet:\n    ```typescript\n    const getNestedValue = (obj: any, path: string): any => { ... }\n    ```\n    Dies deaktiviert TypeScript vollst√§ndig und √∂ffnet T√ºr und Tor f√ºr Runtime Errors, wenn `obj` nicht die erwartete Struktur hat.\n\n2.  **Unsafe Type Casting**:\n    In `changeLanguage` wird der Input `lang` blind gecastet:\n    ```typescript\n    router.replace({pathname}, {locale: lang as \"de\" | \"en\"});\n    ```\n    Wenn `lang` einen anderen Wert hat (durch Aufruf von extern/Konsole), k√∂nnte dies zu unerwartetem Routing-Verhalten f√ºhren.\n\n3.  **Silent Error Suppression**:\n    Die `t` Funktion f√§ngt *alle* Fehler ab und gibt einfach den Key zur√ºck:\n    ```typescript\n    } catch {\n        return key as unknown as T;\n    }\n    ```\n    Dies erschwert das Debugging massiv. Wenn Fehler auftreten, sollten diese zumindest geloggt werden (in Dev/Staging).\n\n# üîç Code-Qualit√§ts-Audit\n\n1.  **Reinventing the Wheel**:\n    Es wird eine eigene `getNestedValue` Funktion implementiert, obwohl `next-intl` oder Bibliotheken wie `lodash` dies robuster l√∂sen.\n2.  **Prop Drilling / Context**:\n    Die Implementierung von `LanguageContext` scheint sich mit `next-intl` zu √ºberschneiden. `next-intl` bietet bereits `useLocale`, `useTranslations` etc. Es ist unklar, warum der manuelle Context hier noch so komplex sein muss.\n\n# üí° Refactoring-Forderungen\n\n**1. Entfernen von `any` in `getNestedValue`:**\n\n```typescript\n// Besser: Generics oder unknown nutzen\nconst getNestedValue = <T = unknown>(obj: Record<string, unknown>, path: string): T | undefined => {\n  return path.split('.').reduce((acc, part) => {\n    if (acc && typeof acc === 'object' && part in acc) {\n      return (acc as Record<string, unknown>)[part];\n    }\n    return undefined;\n  }, obj) as T;\n};\n```\n\n**2. Guard Clause in `changeLanguage`:**\n\n```typescript\nconst changeLanguage = async (lang: string) => {\n  if (lang !== 'de' && lang !== 'en') {\n     console.error(`Invalid locale: ${lang}`);\n     return;\n  }\n  // ...\n```\n\n**3. Error Logging in `t`:**\n\n```typescript\n} catch (error) {\n    console.warn(`Translation missing for key: ${key}`, error);\n    return key as unknown as T;\n}\n```\n\n# Fragen\n\n1.  Warum wird `src/i18n/request.ts` eingef√ºhrt (Standard Next-Intl), aber in `layout.tsx` noch viel manuelle Logik (`LanguageContext`, `getNestedValue`) beibehalten? Ziel sollte sein, vollst√§ndig auf `next-intl` APIs zu setzen.\n","createdAt":"2026-01-08T20:20:01Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/janhartje/drachenbootplan/pull/129#issuecomment-3725611074","viewerDidAuthor":true}]}
