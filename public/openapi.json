{
    "openapi": "3.0.0",
    "info": {
        "title": "Drachenboot Manager API",
        "version": "2.7.0",
        "description": "API documentation for the Drachenboot Manager application with multi-team support.\n\n## Custom Profile Pictures\n\nThe application supports custom profile picture uploads through Next.js Server Actions (not REST endpoints):\n\n### Upload Profile Image\n- **Action**: `uploadProfileImage(base64Image: string)`\n- **Description**: Upload a custom profile picture stored as base64 in the database\n- **Authentication**: Required (JWT session)\n- **Validation**: \n  - Max file size: 2MB\n  - Allowed formats: JPEG, PNG, WebP, GIF\n  - Server-side validation: Magic bytes check using file-type library\n  - Server-side processing: Re-processed with Sharp (400x400, WebP, metadata stripped)\n- **Priority**: Custom images take priority over OAuth provider images\n\n### Delete Profile Image\n- **Action**: `deleteProfileImage()`\n- **Description**: Remove custom profile picture (falls back to OAuth provider image)\n- **Authentication**: Required (JWT session)\n\n### Avatar Image Endpoint\nThe `/api/users/[userId]/avatar` endpoint serves profile images efficiently:\n- **Endpoint**: `GET /api/users/{userId}/avatar`\n- **Description**: Dedicated endpoint for serving user avatars (custom or OAuth)\n- **Priority**: Returns custom image if available, otherwise OAuth image\n- **Response**: Binary image data or redirect to OAuth provider URL\n- **Caching**: Includes cache headers for optimal performance\n- **Note**: This endpoint reduces payload size in list APIs by serving images separately"
    },
    "servers": [
        {
            "url": "http://localhost:3000",
            "description": "Local Development Server"
        }
    ],
    "paths": {
        "/api/admin/stats": {
            "get": {
                "summary": "Get Admin Statistics",
                "description": "Fetches system-wide statistics for the admin dashboard. Requires ADMIN role.",
                "tags": [
                    "Admin"
                ],
                "responses": {
                    "200": {
                        "description": "Admin statistics",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "counts": {
                                            "type": "object",
                                            "properties": {
                                                "users": {
                                                    "type": "integer"
                                                },
                                                "teams": {
                                                    "type": "integer"
                                                },
                                                "events": {
                                                    "type": "integer"
                                                },
                                                "paddlers": {
                                                    "type": "integer"
                                                },
                                                "openInvites": {
                                                    "type": "integer"
                                                },
                                                "activeSessions": {
                                                    "type": "integer"
                                                },
                                                "sentEmails": {
                                                    "type": "integer"
                                                }
                                            }
                                        },
                                        "recent": {
                                            "type": "object",
                                            "properties": {
                                                "teams": {
                                                    "type": "array",
                                                    "items": {
                                                        "type": "object"
                                                    }
                                                },
                                                "events": {
                                                    "type": "array",
                                                    "items": {
                                                        "type": "object"
                                                    }
                                                },
                                                "users": {
                                                    "type": "array",
                                                    "items": {
                                                        "type": "object"
                                                    }
                                                }
                                            }
                                        },
                                        "history": {
                                            "type": "object",
                                            "properties": {
                                                "teams": {
                                                    "type": "object",
                                                    "properties": {
                                                        "days": {
                                                            "type": "array",
                                                            "items": {
                                                                "type": "object"
                                                            }
                                                        },
                                                        "months": {
                                                            "type": "array",
                                                            "items": {
                                                                "type": "object"
                                                            }
                                                        }
                                                    }
                                                },
                                                "users": {
                                                    "type": "object",
                                                    "properties": {
                                                        "days": {
                                                            "type": "array",
                                                            "items": {
                                                                "type": "object"
                                                            }
                                                        },
                                                        "months": {
                                                            "type": "array",
                                                            "items": {
                                                                "type": "object"
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized - User is not logged in",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "Forbidden - User is not an admin",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/cron/ical-sync": {
            "get": {
                "summary": "Trigger iCal Sync (Cron)",
                "description": "Triggers automated iCal synchronization for all teams. Requires CRON_SECRET token.",
                "tags": [
                    "Cron",
                    "iCal"
                ],
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Sync completed",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "success": {
                                            "type": "boolean"
                                        },
                                        "results": {
                                            "type": "array",
                                            "items": {
                                                "type": "object"
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized - Missing or invalid CRON_SECRET"
                    }
                }
            }
        },
        "/api/mcp": {
            "post": {
                "summary": "Execute MCP Tool",
                "description": "Executes a Model Context Protocol tool. Requires Valid API Key.",
                "tags": [
                    "MCP"
                ],
                "security": [
                    {
                        "ApiKeyAuth": []
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "tool": {
                                        "type": "string",
                                        "description": "Name of the tool to execute"
                                    },
                                    "arguments": {
                                        "type": "object",
                                        "description": "Tool arguments"
                                    },
                                    "apiKey": {
                                        "type": "string",
                                        "description": "Valid API Key"
                                    }
                                },
                                "required": [
                                    "tool",
                                    "apiKey"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Tool executed successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "success": {
                                            "type": "boolean"
                                        },
                                        "result": {
                                            "type": "object"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized - Invalid API Key"
                    }
                }
            },
            "get": {
                "summary": "List MCP Tools",
                "description": "Returns a list of available MCP tools.",
                "tags": [
                    "MCP"
                ],
                "responses": {
                    "200": {
                        "description": "List of tools",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "tools": {
                                            "type": "array",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "name": {
                                                        "type": "string"
                                                    },
                                                    "description": {
                                                        "type": "string"
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/public/teams": {
            "get": {
                "summary": "Get Public Teams",
                "description": "Fetches teams that have opted-in to be displayed on the public landing page. Limited to 50 teams. No authentication required.",
                "tags": [
                    "Public"
                ],
                "responses": {
                    "200": {
                        "description": "List of public teams",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "type": "object",
                                        "properties": {
                                            "id": {
                                                "type": "string",
                                                "description": "Team ID (unique identifier)"
                                            },
                                            "name": {
                                                "type": "string",
                                                "description": "Team name"
                                            },
                                            "icon": {
                                                "type": "string",
                                                "nullable": true,
                                                "description": "Team logo/icon (base64 or URL)"
                                            },
                                            "website": {
                                                "type": "string",
                                                "nullable": true,
                                                "description": "Team website URL"
                                            }
                                        },
                                        "required": ["id", "name"]
                                    }
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to fetch public teams",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/teams/{id}/api-keys": {
            "get": {
                "summary": "List API Keys",
                "description": "Lists all API keys for a team. Requires CAPTAIN role.",
                "tags": [
                    "API Keys"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "List of API keys",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/components/schemas/ApiKey"
                                    }
                                }
                            }
                        }
                    }
                }
            },
            "post": {
                "summary": "Create API Key",
                "description": "Creates a new API Key. Requires CAPTAIN role.",
                "tags": [
                    "API Keys"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "name": {
                                        "type": "string"
                                    }
                                },
                                "required": [
                                    "name"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "API Key created",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "key": {
                                            "type": "string"
                                        },
                                        "record": {
                                            "$ref": "#/components/schemas/ApiKey"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/teams/{id}/api-keys/{keyId}": {
            "delete": {
                "summary": "Revoke API Key",
                "tags": [
                    "API Keys"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "keyId",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Key revoked"
                    }
                }
            }
        },
        "/api/teams": {
            "get": {
                "summary": "Get All Teams",
                "description": "Fetches all teams ordered by name.",
                "tags": [
                    "Teams"
                ],
                "responses": {
                    "200": {
                        "description": "List of teams",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/components/schemas/Team"
                                    }
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to fetch teams",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            },
            "post": {
                "summary": "Create Team",
                "description": "Creates a new team. Authenticated users only.",
                "tags": [
                    "Teams"
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "name": {
                                        "type": "string",
                                        "description": "Team name"
                                    }
                                },
                                "required": [
                                    "name"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Team created successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Team"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Name is required",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to create team",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/teams/{id}": {
            "put": {
                "summary": "Update Team",
                "description": "Updates a team's name. Requires CAPTAIN role.",
                "tags": [
                    "Teams"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "description": "Team ID",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "name": {
                                        "type": "string",
                                        "description": "New team name"
                                    },
                                    "website": {
                                        "type": "string",
                                        "nullable": true
                                    },
                                    "icon": {
                                        "type": "string",
                                        "nullable": true
                                    },
                                    "primaryColor": {
                                        "type": "string",
                                        "nullable": true
                                    },
                                    "showProRing": {
                                        "type": "boolean"
                                    },
                                    "showProBadge": {
                                        "type": "boolean"
                                    },
                                    "showWatermark": {
                                        "type": "boolean"
                                    },
                                    "showOnWebsite": {
                                        "type": "boolean",
                                        "description": "Display team on public landing page"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Team updated successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Team"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "Forbidden - Only Captains can update the team",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to update team",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            },
            "delete": {
                "summary": "Delete Team",
                "description": "Deletes a team (Cascade). Requires CAPTAIN role.",
                "tags": [
                    "Teams"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "description": "Team ID",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Team deleted successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "success": {
                                            "type": "boolean"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to delete team",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "error": {
                                            "type": "string"
                                        },
                                        "details": {
                                            "type": "string"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/teams/{id}/import/paddlers": {
            "post": {
                "summary": "Bulk Import Paddlers",
                "description": "Imports multiple paddlers from a parsed Excel/CSV file. Requires CAPTAIN role.",
                "tags": [
                    "Teams",
                    "Import"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "description": "Team ID",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "paddlers": {
                                        "type": "array",
                                        "items": {
                                            "type": "object",
                                            "properties": {
                                                "name": {
                                                    "type": "string",
                                                    "description": "Paddler name"
                                                },
                                                "weight": {
                                                    "type": "number",
                                                    "description": "Weight in kg"
                                                },
                                                "side": {
                                                    "type": "string",
                                                    "description": "Preferred side (left, right, drum, steer, or comma-separated)"
                                                },
                                                "email": {
                                                    "type": "string",
                                                    "description": "Email address for invitation (optional)"
                                                }
                                            },
                                            "required": [
                                                "name"
                                            ]
                                        }
                                    }
                                },
                                "required": [
                                    "paddlers"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Paddlers imported successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "count": {
                                            "type": "integer",
                                            "description": "Number of paddlers imported"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Invalid data format",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "Forbidden - Requires CAPTAIN role or Team Limit reached",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/teams/{id}/import/events": {
            "post": {
                "summary": "Bulk Import Events",
                "description": "Imports multiple events from a parsed Excel/CSV file. Supports separate date and time columns. Requires CAPTAIN role.",
                "tags": [
                    "Teams",
                    "Import"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "description": "Team ID",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "events": {
                                        "type": "array",
                                        "items": {
                                            "type": "object",
                                            "properties": {
                                                "title": {
                                                    "type": "string",
                                                    "description": "Event title"
                                                },
                                                "date": {
                                                    "type": "string",
                                                    "description": "Date (YYYY-MM-DD or DD.MM.YYYY)"
                                                },
                                                "time": {
                                                    "type": "string",
                                                    "description": "Time (HH:mm) - optional, can be merged with date"
                                                },
                                                "type": {
                                                    "type": "string",
                                                    "enum": [
                                                        "training",
                                                        "regatta"
                                                    ],
                                                    "description": "Event type"
                                                },
                                                "boatSize": {
                                                    "type": "string",
                                                    "enum": [
                                                        "standard",
                                                        "small"
                                                    ],
                                                    "description": "Boat size (standard=20, small=10)"
                                                },
                                                "comment": {
                                                    "type": "string",
                                                    "description": "Optional comment/note"
                                                }
                                            },
                                            "required": [
                                                "title",
                                                "date"
                                            ]
                                        }
                                    }
                                },
                                "required": [
                                    "events"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Events imported successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "count": {
                                            "type": "integer",
                                            "description": "Number of events imported"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Invalid data format",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "Forbidden - Requires CAPTAIN role",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/teams/{id}/import/ical": {
            "post": {
                "summary": "Trigger Manual iCal Sync",
                "description": "Triggers an immediate iCal sync for the team. Requires CAPTAIN role.",
                "tags": [
                    "Teams",
                    "iCal"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "description": "Team ID",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Sync successful",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "success": {
                                            "type": "boolean"
                                        },
                                        "created": {
                                            "type": "integer"
                                        },
                                        "updated": {
                                            "type": "integer"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Sync failed",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/teams/{id}/sync-history": {
            "get": {
                "summary": "Get Sync History",
                "description": "Fetches iCal synchronization history for a team. Requires CAPTAIN role.",
                "tags": [
                    "Teams",
                    "iCal"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "description": "Team ID",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "page",
                        "in": "query",
                        "description": "Page number (default 1)",
                        "schema": {
                            "type": "integer",
                            "default": 1
                        }
                    },
                    {
                        "name": "limit",
                        "in": "query",
                        "description": "Items per page (default 10)",
                        "schema": {
                            "type": "integer",
                            "default": 10
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Sync history list",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "data": {
                                            "type": "array",
                                            "items": {
                                                "$ref": "#/components/schemas/SyncLog"
                                            }
                                        },
                                        "pagination": {
                                            "type": "object",
                                            "properties": {
                                                "total": {
                                                    "type": "integer"
                                                },
                                                "page": {
                                                    "type": "integer"
                                                },
                                                "limit": {
                                                    "type": "integer"
                                                },
                                                "totalPages": {
                                                    "type": "integer"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "Forbidden"
                    }
                }
            }
        },
        "/api/paddlers": {
            "get": {
                "summary": "Get Paddlers",
                "description": "Fetches all paddlers for a specific team. Weights are redacted (0) for non-captains.",
                "tags": [
                    "Paddlers"
                ],
                "parameters": [
                    {
                        "name": "teamId",
                        "in": "query",
                        "required": false,
                        "description": "Team ID to filter paddlers",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "List of paddlers",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/components/schemas/PaddlerFull"
                                    }
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to fetch paddlers",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            },
            "post": {
                "summary": "Create Paddler",
                "description": "Creates a new paddler. Requires CAPTAIN role.",
                "tags": [
                    "Paddlers"
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/PaddlerInput"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Paddler created successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/PaddlerFull"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "Forbidden - Requires CAPTAIN role or Team Limit reached",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to create paddler",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/paddlers/{id}": {
            "put": {
                "summary": "Update Paddler",
                "description": "Updates a paddler's information.",
                "tags": [
                    "Paddlers"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "description": "Paddler ID",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "name": {
                                        "type": "string"
                                    },
                                    "weight": {
                                        "type": "number"
                                    },
                                    "side": {
                                        "type": "string",
                                        "enum": [
                                            "left",
                                            "right",
                                            "both"
                                        ],
                                        "nullable": true
                                    },
                                    "skills": {
                                        "type": "array",
                                        "items": {
                                            "type": "string",
                                            "enum": [
                                                "drum",
                                                "steer"
                                            ]
                                        }
                                    },
                                    "isGuest": {
                                        "type": "boolean"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Paddler updated successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/PaddlerFull"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "Forbidden - Non-captains can only update themselves and cannot change roles",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to updates paddler",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            },
            "delete": {
                "summary": "Delete Paddler",
                "description": "Deletes a paddler. Requires CAPTAIN role.",
                "tags": [
                    "Paddlers"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "description": "Paddler ID",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Paddler deleted successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "success": {
                                            "type": "boolean"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to delete paddler",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/events": {
            "get": {
                "summary": "Get Events",
                "description": "Fetches all events for a specific team with attendances and assignments. Guest weights are redacted (0) for non-captains.",
                "tags": [
                    "Events"
                ],
                "parameters": [
                    {
                        "name": "teamId",
                        "in": "query",
                        "required": false,
                        "description": "Team ID to filter events",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "List of events",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/components/schemas/EventFull"
                                    }
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to fetch events",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            },
            "post": {
                "summary": "Create Event",
                "description": "Creates a new event. Requires CAPTAIN role.",
                "tags": [
                    "Events"
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/EventInput"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Event created successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Event"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to create event",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/events/{id}": {
            "put": {
                "summary": "Update Event",
                "description": "Updates an event's information.",
                "tags": [
                    "Events"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "description": "Event ID",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "title": {
                                        "type": "string"
                                    },
                                    "date": {
                                        "type": "string",
                                        "format": "date-time"
                                    },
                                    "type": {
                                        "type": "string",
                                        "enum": [
                                            "training",
                                            "regatta"
                                        ]
                                    },
                                    "boatSize": {
                                        "type": "string",
                                        "enum": [
                                            "standard",
                                            "small"
                                        ]
                                    },
                                    "canisterCount": {
                                        "type": "integer"
                                    },
                                    "comment": {
                                        "type": "string",
                                        "nullable": true,
                                        "description": "Optional comment/note for the event"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Event updated successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Event"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to update event",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            },
            "delete": {
                "summary": "Delete Event",
                "description": "Deletes an event and all its guest paddlers (cascade deletes attendances and assignments).",
                "tags": [
                    "Events"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "description": "Event ID",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Event deleted successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "success": {
                                            "type": "boolean"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to delete event",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/events/{id}/assignments": {
            "post": {
                "summary": "Save Boat Assignments",
                "description": "Replaces assignments. Requires CAPTAIN role.",
                "tags": [
                    "Events"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "description": "Event ID",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "assignments": {
                                        "type": "object",
                                        "additionalProperties": {
                                            "type": "string"
                                        },
                                        "description": "Map of seatId to paddlerId (or canister-N)"
                                    }
                                },
                                "required": [
                                    "assignments"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Assignments saved successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "success": {
                                            "type": "boolean"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to save assignments",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/events/{id}/attendance": {
            "post": {
                "summary": "Update Attendance",
                "description": "Updates attendance. Captains can update anyone; Paddlers can only update themselves.",
                "tags": [
                    "Events"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "description": "Event ID",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "paddlerId": {
                                        "type": "string"
                                    },
                                    "status": {
                                        "type": "string",
                                        "enum": [
                                            "yes",
                                            "no",
                                            "maybe"
                                        ]
                                    }
                                },
                                "required": [
                                    "paddlerId",
                                    "status"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Attendance updated successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Attendance"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to update attendance",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/events/{id}/canisters": {
            "post": {
                "summary": "Add Canister",
                "description": "Increments the canister count for an event.",
                "tags": [
                    "Events"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "description": "Event ID",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Canister added successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "canisterCount": {
                                            "type": "integer"
                                        },
                                        "newCanisterId": {
                                            "type": "string",
                                            "description": "ID of the new canister (e.g., 'canister-1')"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to add canister",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            },
            "delete": {
                "summary": "Remove Canister",
                "description": "Decrements the canister count. Only works if there are unassigned canisters.",
                "tags": [
                    "Events"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "description": "Event ID",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "canisterId",
                        "in": "query",
                        "required": true,
                        "description": "Canister ID (e.g., 'canister-1')",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Canister removed successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "success": {
                                            "type": "boolean"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Canister ID required or canister is assigned",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to remove canister",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/events/{id}/guests": {
            "post": {
                "summary": "Add Guest Paddler",
                "description": "Creates a guest paddler for a specific event with automatic attendance.",
                "tags": [
                    "Events"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "description": "Event ID",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "name": {
                                        "type": "string"
                                    },
                                    "weight": {
                                        "type": "number"
                                    },
                                    "skills": {
                                        "type": "array",
                                        "items": {
                                            "type": "string",
                                            "enum": [
                                                "drum",
                                                "steer"
                                            ]
                                        }
                                    }
                                },
                                "required": [
                                    "name",
                                    "weight",
                                    "skills"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Guest paddler created successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/PaddlerFull"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to add guest",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/events/{id}/guests/{guestId}": {
            "delete": {
                "summary": "Remove Guest Paddler",
                "description": "Deletes a guest paddler (cascade deletes attendance and assignments).",
                "tags": [
                    "Events"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "description": "Event ID",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "guestId",
                        "in": "path",
                        "required": true,
                        "description": "Guest paddler ID",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Guest removed successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "success": {
                                            "type": "boolean"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to remove guest",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/autofill": {
            "post": {
                "summary": "Auto-fill Boat Assignments",
                "description": "Calculates optimal seat assignments based on paddler pool and constraints using the Magic AI algorithm.",
                "tags": [
                    "Planner"
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "eventId": {
                                        "type": "string",
                                        "description": "Event ID to fetch config and pool"
                                    },
                                    "assignments": {
                                        "type": "object",
                                        "additionalProperties": {
                                            "type": "string"
                                        },
                                        "description": "Current assignments (optional overrides)",
                                        "nullable": true
                                    },
                                    "lockedSeats": {
                                        "type": "array",
                                        "items": {
                                            "type": "string"
                                        },
                                        "description": "List of locked seat IDs",
                                        "nullable": true
                                    },
                                    "targetTrim": {
                                        "type": "number",
                                        "description": "Target trim (defaults to 0)",
                                        "nullable": true
                                    }
                                },
                                "required": [
                                    "eventId"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Successful assignment calculation",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "assignments": {
                                            "type": "object",
                                            "additionalProperties": {
                                                "type": "string"
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Invalid input parameters"
                    },
                    "500": {
                        "description": "Internal server error"
                    }
                }
            }
        },
        "/api/stats": {
            "post": {
                "summary": "Calculate Boat Statistics",
                "description": "Calculates boat statistics (weight distribution, trim, center of gravity) based on event and assignments. Weights are fetched from server database.",
                "tags": [
                    "Planner"
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "eventId": {
                                        "type": "string",
                                        "description": "Event ID to fetch boat configuration and default assignments"
                                    },
                                    "assignments": {
                                        "type": "object",
                                        "additionalProperties": {
                                            "type": "string"
                                        },
                                        "description": "Optional map of seat IDs to paddler IDs (overrides DB assignments)",
                                        "nullable": true
                                    },
                                    "targetTrim": {
                                        "type": "number",
                                        "description": "Target trim value in kg (optional)",
                                        "nullable": true
                                    }
                                },
                                "required": [
                                    "eventId"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Statistics calculated successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/BoatStats"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Missing eventId",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Calculation failed",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/cron/mail-queue": {
            "get": {
                "summary": "Process Mail Queue",
                "description": "Triggers the processing of pending emails in the queue.",
                "tags": [
                    "System"
                ],
                "responses": {
                    "200": {
                        "description": "Queue processed successfully"
                    },
                    "500": {
                        "description": "Internal server error"
                    }
                }
            }
        },
        "/api/contact": {
            "post": {
                "summary": "Send Contact Email",
                "description": "Sends a contact/support email to the administrator.",
                "tags": [
                    "System"
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "category": {
                                        "type": "string"
                                    },
                                    "message": {
                                        "type": "string"
                                    },
                                    "name": {
                                        "type": "string"
                                    },
                                    "email": {
                                        "type": "string"
                                    }
                                },
                                "required": [
                                    "category",
                                    "message"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Email sent successfully"
                    },
                    "400": {
                        "description": "Missing fields"
                    },
                    "401": {
                        "description": "Unauthorized"
                    },
                    "500": {
                        "description": "Failed to send email"
                    }
                }
            }
        },
        "/api/user/preferences": {
            "get": {
                "summary": "Get User Preferences",
                "description": "Fetches current user's preferences (theme, language, activeTeam).",
                "tags": [
                    "User"
                ],
                "responses": {
                    "200": {
                        "description": "User preferences",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "theme": {
                                            "type": "string"
                                        },
                                        "language": {
                                            "type": "string"
                                        },
                                        "activeTeamId": {
                                            "type": "string"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized"
                    }
                }
            },
            "put": {
                "summary": "Update User Preferences",
                "description": "Updates user's preferences.",
                "tags": [
                    "User"
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "theme": {
                                        "type": "string"
                                    },
                                    "language": {
                                        "type": "string"
                                    },
                                    "activeTeamId": {
                                        "type": "string"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Preferences updated"
                    },
                    "400": {
                        "description": "Invalid values"
                    },
                    "401": {
                        "description": "Unauthorized"
                    },
                    "403": {
                        "description": "Not member of team (if switching activeTeamId)"
                    }
                }
            }
        },
        "/api/stripe/setup-intent": {
            "post": {
                "summary": "Create Setup Intent",
                "description": "Creates a Stripe SetupIntent for setting up a new payment method. Creates a Stripe customer if one doesn't exist for the team.",
                "tags": [
                    "Billing"
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "teamId": {
                                        "type": "string",
                                        "description": "Team ID to setup payment for"
                                    }
                                },
                                "required": [
                                    "teamId"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Setup intent created successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "clientSecret": {
                                            "type": "string",
                                            "description": "Client secret for Stripe Elements"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Team ID is required",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "Insufficient permissions - must be captain or billing user",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/stripe/invoices": {
            "get": {
                "summary": "Get Team Invoices",
                "description": "Retrieves the list of invoices for a team's Stripe customer. Billing user or captain required.",
                "tags": [
                    "Billing"
                ],
                "parameters": [
                    {
                        "name": "teamId",
                        "in": "query",
                        "required": true,
                        "description": "Team ID to fetch invoices for",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "List of invoices",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "invoices": {
                                            "type": "array",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "id": {
                                                        "type": "string"
                                                    },
                                                    "date": {
                                                        "type": "integer",
                                                        "description": "Unix timestamp"
                                                    },
                                                    "amount": {
                                                        "type": "integer",
                                                        "description": "Amount in cents"
                                                    },
                                                    "currency": {
                                                        "type": "string"
                                                    },
                                                    "status": {
                                                        "type": "string"
                                                    },
                                                    "invoicePdf": {
                                                        "type": "string",
                                                        "nullable": true,
                                                        "description": "URL to download PDF"
                                                    },
                                                    "number": {
                                                        "type": "string",
                                                        "nullable": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Team ID is required",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "Insufficient permissions - must be billing user or captain",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/stripe/subscription-details": {
            "get": {
                "summary": "Get Subscription Details",
                "description": "Retrieves detailed subscription information for a team including payment method, billing period, and subscription history.",
                "tags": [
                    "Billing"
                ],
                "parameters": [
                    {
                        "name": "teamId",
                        "in": "query",
                        "required": true,
                        "description": "Team ID to fetch subscription for",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Subscription details",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "hasSubscription": {
                                            "type": "boolean"
                                        },
                                        "plan": {
                                            "type": "string",
                                            "description": "Current plan (FREE, PRO)"
                                        },
                                        "isBillingUser": {
                                            "type": "boolean"
                                        },
                                        "isCustomer": {
                                            "type": "boolean"
                                        },
                                        "subscription": {
                                            "type": "object",
                                            "nullable": true,
                                            "properties": {
                                                "id": {
                                                    "type": "string"
                                                },
                                                "status": {
                                                    "type": "string"
                                                },
                                                "cancelAtPeriodEnd": {
                                                    "type": "boolean"
                                                },
                                                "currentPeriodEnd": {
                                                    "type": "integer"
                                                },
                                                "currentPeriodStart": {
                                                    "type": "integer"
                                                },
                                                "interval": {
                                                    "type": "string",
                                                    "enum": [
                                                        "month",
                                                        "year"
                                                    ]
                                                },
                                                "amount": {
                                                    "type": "integer"
                                                },
                                                "currency": {
                                                    "type": "string"
                                                },
                                                "priceId": {
                                                    "type": "string"
                                                },
                                                "paymentMethod": {
                                                    "type": "object",
                                                    "nullable": true,
                                                    "properties": {
                                                        "brand": {
                                                            "type": "string"
                                                        },
                                                        "last4": {
                                                            "type": "string"
                                                        },
                                                        "expMonth": {
                                                            "type": "integer"
                                                        },
                                                        "expYear": {
                                                            "type": "integer"
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        "history": {
                                            "type": "array",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "id": {
                                                        "type": "string"
                                                    },
                                                    "status": {
                                                        "type": "string"
                                                    },
                                                    "currentPeriodStart": {
                                                        "type": "integer"
                                                    },
                                                    "currentPeriodEnd": {
                                                        "type": "integer"
                                                    },
                                                    "cancelAtPeriodEnd": {
                                                        "type": "boolean"
                                                    },
                                                    "interval": {
                                                        "type": "string"
                                                    },
                                                    "amount": {
                                                        "type": "integer"
                                                    },
                                                    "currency": {
                                                        "type": "string"
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Team ID is required",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "Not authorized or team not found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/stripe/update-subscription": {
            "post": {
                "summary": "Update Subscription",
                "description": "Cancels or reactivates a subscription. Only the billing user can perform this action.",
                "tags": [
                    "Billing"
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "teamId": {
                                        "type": "string",
                                        "description": "Team ID"
                                    },
                                    "action": {
                                        "type": "string",
                                        "enum": [
                                            "cancel",
                                            "reactivate"
                                        ],
                                        "description": "Action to perform"
                                    }
                                },
                                "required": [
                                    "teamId",
                                    "action"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Action performed successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "success": {
                                            "type": "boolean"
                                        },
                                        "message": {
                                            "type": "string"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Invalid action or no subscription found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "Only the billing admin can manage the subscription",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/paddlers": {
            "get": {
                "summary": "List Paddlers",
                "description": "Lists paddlers for a specific team. Supports parallel fetching.",
                "tags": [
                    "Paddlers"
                ],
                "parameters": [
                    {
                        "name": "teamId",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "List of paddlers",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/components/schemas/Paddler"
                                    }
                                }
                            }
                        }
                    }
                }
            },
            "post": {
                "summary": "Create Paddler",
                "description": "Creates a new paddler. Authenticated users only.",
                "tags": [
                    "Paddlers"
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "teamId": {
                                        "type": "string"
                                    },
                                    "name": {
                                        "type": "string"
                                    },
                                    "weight": {
                                        "type": "number"
                                    },
                                    "skills": {
                                        "type": "array",
                                        "items": {
                                            "type": "string"
                                        }
                                    },
                                    "isGuest": {
                                        "type": "boolean"
                                    }
                                },
                                "required": [
                                    "teamId",
                                    "name"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Paddler created",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Paddler"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/events": {
            "get": {
                "summary": "List Events",
                "description": "Lists events for a team.",
                "tags": [
                    "Events"
                ],
                "parameters": [
                    {
                        "name": "teamId",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "List of events",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/components/schemas/Event"
                                    }
                                }
                            }
                        }
                    }
                }
            },
            "post": {
                "summary": "Create Event",
                "tags": [
                    "Events"
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "teamId": {
                                        "type": "string"
                                    },
                                    "title": {
                                        "type": "string"
                                    },
                                    "date": {
                                        "type": "string",
                                        "format": "date-time"
                                    },
                                    "type": {
                                        "type": "string"
                                    },
                                    "boatSize": {
                                        "type": "string"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Event created"
                    }
                }
            }
        },
        "/api/events/{id}/assignments": {
            "get": {
                "summary": "Get Assignments",
                "tags": [
                    "Assignments"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "List of assignments",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/components/schemas/Assignment"
                                    }
                                }
                            }
                        }
                    }
                }
            },
            "patch": {
                "summary": "Update Assignment",
                "tags": [
                    "Assignments"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "seatId": {
                                        "type": "string"
                                    },
                                    "paddlerId": {
                                        "type": "string",
                                        "nullable": true
                                    },
                                    "isCanister": {
                                        "type": "boolean"
                                    }
                                },
                                "required": [
                                    "seatId"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Assignment updated"
                    }
                }
            }
        },
        "/api/events/{id}/attendance": {
            "post": {
                "summary": "Set Attendance",
                "tags": [
                    "Attendance"
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "paddlerId": {
                                        "type": "string"
                                    },
                                    "status": {
                                        "type": "string",
                                        "enum": [
                                            "yes",
                                            "no",
                                            "maybe"
                                        ]
                                    }
                                },
                                "required": [
                                    "paddlerId",
                                    "status"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Attendance updated"
                    }
                }
            }
        }
    },
    "components": {
        "schemas": {
            "Team": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Unique team identifier (CUID)"
                    },
                    "name": {
                        "type": "string",
                        "description": "Team name"
                    },
                    "createdAt": {
                        "type": "string",
                        "format": "date-time",
                        "description": "Team creation timestamp"
                    },
                    "updatedAt": {
                        "type": "string",
                        "format": "date-time",
                        "description": "Last update timestamp"
                    },
                    "primaryColor": {
                        "type": "string",
                        "nullable": true
                    },
                    "showProRing": {
                        "type": "boolean"
                    },
                    "showProBadge": {
                        "type": "boolean"
                    },
                    "showWatermark": {
                        "type": "boolean"
                    },
                    "showOnWebsite": {
                        "type": "boolean",
                        "description": "Display team on public landing page",
                        "default": false
                    }
                },
                "required": [
                    "id",
                    "name",
                    "createdAt",
                    "updatedAt"
                ]
            },
            "Paddler": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string"
                    },
                    "name": {
                        "type": "string"
                    },
                    "teamId": {
                        "type": "string",
                        "nullable": true,
                        "description": "Associated team ID"
                    },
                    "weight": {
                        "type": "number",
                        "description": "Weight in kg (redacted/0 for non-captains)"
                    },
                    "side": {
                        "type": "string",
                        "enum": [
                            "left",
                            "right",
                            "both"
                        ],
                        "nullable": true
                    },
                    "skills": {
                        "type": "array",
                        "items": {
                            "type": "string",
                            "enum": [
                                "drum",
                                "steer"
                            ]
                        }
                    },
                    "isCanister": {
                        "type": "boolean"
                    },
                    "isGuest": {
                        "type": "boolean"
                    }
                },
                "required": [
                    "id",
                    "name",
                    "weight",
                    "skills"
                ]
            },
            "PaddlerFull": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Unique paddler identifier (CUID)"
                    },
                    "name": {
                        "type": "string"
                    },
                    "teamId": {
                        "type": "string",
                        "nullable": true,
                        "description": "Associated team ID"
                    },
                    "weight": {
                        "type": "number",
                        "description": "Weight in kg (redacted/0 for non-captains)"
                    },
                    "side": {
                        "type": "string",
                        "enum": [
                            "left",
                            "right",
                            "both"
                        ],
                        "nullable": true
                    },
                    "skills": {
                        "type": "array",
                        "items": {
                            "type": "string",
                            "enum": [
                                "drum",
                                "steer"
                            ]
                        }
                    },
                    "isGuest": {
                        "type": "boolean"
                    },
                    "createdAt": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "updatedAt": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "user": {
                        "type": "object",
                        "properties": {
                            "name": {
                                "type": "string",
                                "nullable": true
                            },
                            "email": {
                                "type": "string",
                                "nullable": true
                            },
                            "image": {
                                "type": "string",
                                "nullable": true,
                                "description": "OAuth provider profile image URL (Google/GitHub)"
                            },
                            "customImage": {
                                "type": "string",
                                "nullable": true,
                                "description": "Custom uploaded profile picture (base64 encoded). Takes priority over OAuth image."
                            }
                        },
                        "nullable": true
                    }
                },
                "required": [
                    "id",
                    "name",
                    "weight",
                    "skills",
                    "isGuest",
                    "createdAt",
                    "updatedAt"
                ]
            },
            "PaddlerInput": {
                "type": "object",
                "properties": {
                    "name": {
                        "type": "string"
                    },
                    "teamId": {
                        "type": "string",
                        "description": "Team ID (required)"
                    },
                    "weight": {
                        "type": "number",
                        "description": "Weight in kg"
                    },
                    "side": {
                        "type": "string",
                        "enum": [
                            "left",
                            "right",
                            "both"
                        ],
                        "nullable": true
                    },
                    "skills": {
                        "type": "array",
                        "items": {
                            "type": "string",
                            "enum": [
                                "drum",
                                "steer"
                            ]
                        }
                    },
                    "isGuest": {
                        "type": "boolean",
                        "default": false
                    }
                },
                "required": [
                    "name",
                    "teamId",
                    "weight",
                    "skills"
                ]
            },
            "Event": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Unique event identifier (UUID)"
                    },
                    "title": {
                        "type": "string"
                    },
                    "teamId": {
                        "type": "string",
                        "nullable": true
                    },
                    "date": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "type": {
                        "type": "string",
                        "enum": [
                            "training",
                            "regatta"
                        ],
                        "default": "training"
                    },
                    "boatSize": {
                        "type": "string",
                        "enum": [
                            "standard",
                            "small"
                        ],
                        "default": "standard"
                    },
                    "canisterCount": {
                        "type": "integer",
                        "default": 0
                    },
                    "createdAt": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "updatedAt": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "comment": {
                        "type": "string",
                        "nullable": true,
                        "description": "Optional comment/note for the event"
                    }
                },
                "required": [
                    "id",
                    "title",
                    "date",
                    "type",
                    "boatSize",
                    "createdAt",
                    "updatedAt"
                ]
            },
            "EventFull": {
                "allOf": [
                    {
                        "$ref": "#/components/schemas/Event"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "attendances": {
                                "type": "array",
                                "items": {
                                    "$ref": "#/components/schemas/Attendance"
                                }
                            },
                            "assignments": {
                                "type": "array",
                                "items": {
                                    "$ref": "#/components/schemas/Assignment"
                                }
                            }
                        }
                    }
                ]
            },
            "EventInput": {
                "type": "object",
                "properties": {
                    "title": {
                        "type": "string"
                    },
                    "teamId": {
                        "type": "string",
                        "description": "Team ID (required)"
                    },
                    "date": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "type": {
                        "type": "string",
                        "enum": [
                            "training",
                            "regatta"
                        ],
                        "default": "training"
                    },
                    "boatSize": {
                        "type": "string",
                        "enum": [
                            "standard",
                            "small"
                        ],
                        "default": "standard"
                    },
                    "comment": {
                        "type": "string",
                        "nullable": true,
                        "description": "Optional comment/note"
                    }
                },
                "required": [
                    "title",
                    "teamId",
                    "date"
                ]
            },
            "Attendance": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string"
                    },
                    "eventId": {
                        "type": "string"
                    },
                    "paddlerId": {
                        "type": "string"
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "yes",
                            "no",
                            "maybe"
                        ]
                    }
                },
                "required": [
                    "id",
                    "eventId",
                    "paddlerId",
                    "status"
                ]
            },
            "ApiKey": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string"
                    },
                    "name": {
                        "type": "string"
                    },
                    "lastUsed": {
                        "type": "string",
                        "format": "date-time",
                        "nullable": true
                    },
                    "createdAt": {
                        "type": "string",
                        "format": "date-time"
                    }
                }
            },
            "Assignment": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string"
                    },
                    "eventId": {
                        "type": "string"
                    },
                    "seatId": {
                        "type": "string",
                        "description": "Seat identifier (e.g., 'row-1-left', 'drummer', 'steer')"
                    },
                    "paddlerId": {
                        "type": "string",
                        "nullable": true
                    },
                    "isCanister": {
                        "type": "boolean"
                    }
                },
                "required": [
                    "id",
                    "eventId",
                    "seatId",
                    "isCanister"
                ]
            },
            "BoatStats": {
                "type": "object",
                "properties": {
                    "stats": {
                        "type": "object",
                        "properties": {
                            "l": {
                                "type": "number",
                                "description": "Left side weight"
                            },
                            "r": {
                                "type": "number",
                                "description": "Right side weight"
                            },
                            "t": {
                                "type": "number",
                                "description": "Total weight"
                            },
                            "diffLR": {
                                "type": "number",
                                "description": "Difference Left-Right"
                            },
                            "f": {
                                "type": "number",
                                "description": "Front weight"
                            },
                            "b": {
                                "type": "number",
                                "description": "Back weight"
                            },
                            "diffFB": {
                                "type": "number",
                                "description": "Difference Front-Back"
                            },
                            "c": {
                                "type": "integer",
                                "description": "Count of paddlers"
                            }
                        }
                    },
                    "cgStats": {
                        "type": "object",
                        "properties": {
                            "x": {
                                "type": "number",
                                "description": "Center of Gravity X (0-100)"
                            },
                            "y": {
                                "type": "number",
                                "description": "Center of Gravity Y (0-100)"
                            },
                            "targetY": {
                                "type": "number",
                                "description": "Target CG Y based on trim"
                            }
                        }
                    }
                }
            },
            "SyncLog": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string"
                    },
                    "teamId": {
                        "type": "string"
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "SUCCESS",
                            "ERROR"
                        ]
                    },
                    "createdCount": {
                        "type": "integer"
                    },
                    "updatedCount": {
                        "type": "integer"
                    },
                    "error": {
                        "type": "string",
                        "nullable": true
                    },
                    "createdAt": {
                        "type": "string",
                        "format": "date-time"
                    }
                },
                "required": [
                    "id",
                    "teamId",
                    "status",
                    "createdAt"
                ]
            },
            "Error": {
                "type": "object",
                "properties": {
                    "error": {
                        "type": "string",
                        "description": "Error message"
                    }
                },
                "required": [
                    "error"
                ]
            }
        },
        "securitySchemes": {
            "sessionAuth": {
                "type": "apiKey",
                "in": "cookie",
                "name": "authjs.session-token",
                "description": "Session-based authentication using NextAuth.js. Requires active login session."
            }
        }
    },
    "security": [
        {
            "sessionAuth": []
        }
    ],
    "tags": [
        {
            "name": "Teams",
            "description": "Team management operations"
        },
        {
            "name": "Paddlers",
            "description": "Paddler management operations"
        },
        {
            "name": "Events",
            "description": "Event management operations"
        },
        {
            "name": "Planner",
            "description": "Boat planning and assignment operations"
        },
        {
            "name": "Billing",
            "description": "Subscription and payment management via Stripe"
        }
    ]
}
